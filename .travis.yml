sudo: required
dist: trusty
language: java
jobs:
  include:
    #Other modules can refer to oap-cache-oap to build independent travis-ci job,
    #oap-cache-oap is a CI building demo of the corresponding module oap-cache/oap.
    - name: oap-cache-oap
      before_install:
      - sudo apt-get install libpthread-stubs0-dev
      - sudo apt-get install libnuma-dev
      - sudo apt-get install cmake
      install:
      - # Download spark 2.4.4
      - "[ -f spark ] || mkdir spark && cd spark && wget http://archive.apache.org/dist/spark/spark-2.4.4/spark-2.4.4-bin-hadoop2.7.tgz && cd .."
      - "tar -xf ./spark/spark-2.4.4-bin-hadoop2.7.tgz"
      - "export SPARK_HOME=`pwd`/spark-2.4.4-bin-hadoop2.7"
      before_script:
      - cd ${TRAVIS_BUILD_DIR}/dev
      - ./install_vmemcache.sh
      - ./install_arrow.sh
      - ./install_memkind.sh
      script:
      - cd ${TRAVIS_BUILD_DIR}
      - mvn clean -q -Ppersistent-memory -Pvmemcache test
    - name: oap-shuffle-remote-shuffle
      install:
      # travis will add a command by default
      # mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
      # if we don't define an install step in our job,this command will run before all the commands in our travis.yml and run in ${TRAVIS_BUILD_DIR} directory according to our pom.xml in ${TRAVIS_BUILD_DIR}
      # better way to define at least one install step and one script step in a job even if there is no actual actions in them
      - #empty install step
      script:
      - cd ${TRAVIS_BUILD_DIR}/oap-shuffle/remote-shuffle
      - mvn -q test
